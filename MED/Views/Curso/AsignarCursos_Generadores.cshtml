@using MED.Models;
@{
    var emp = ViewData["LstEmp"] as ListEmpleados;
}
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>AsignarCursos_Generadores</title>
</head>
<body>
    <div>
        @for (int i = 0; i < emp.LstEmp.Count; i++)
        {
            @*<option value="">@cursos.Cursos[i].Nombre_Curso</option>*@
            <input type="text" class="form-control" value="@emp.LstEmp[i].id_Empleado" id="Id_empleado_G" />
            <br />
        }
        <button type="button" class="btn btn-info" onclick="Traer_Generadores()">Asignar curso</button>
    </div>
    <script>
        //Trae todos los datos para poder mandar a llamar el metodo que asigna curso
        function Traer_Generadores() {
            var id = document.querySelectorAll('input[id="Id_empleado_G"]');
            for (var i = 0; i < id.length; i++) {
                setTimeout(
                    //Encriptar_Pass(id[i].value, clabe[i].value, numcu[i].value), 1000
                    AsignarCurso_Generadores(id[i].value), 1000
                );
                //console.log(id[i].value,clabe[i].value, numcu[i].value);
                // console.log(id[i].value, numEmp[i].value);
            }
            console.log(id);
        }

        //Mandadara los datos para poder ser encriptados
        function AsignarCurso_Generadores(Id_Empleado) {
            var xml = new XMLHttpRequest();
            var url =  "/Curso/Asignar_Curso";
            var json = {
                id_curso: 53,
                id_emp: Id_Empleado,
                capacitador: 709
            }

            xml.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var r = JSON.parse(this.responseText);
                    console.log(r);
                    if (r == 1) {
                        alertify.success("Curso asignado correctamente");
                        console.log("1");
                    } else if (r = 2) {
                        alertify.alert("Usuario cuenta con mismo curso sin terminar. Favor de terminar el curso antes asignado, antes de asignar uno nuevo");
                        console.log("2");
                    } else {
                        alertify.error("Error al asignar");
                        console.log("3");
                    }
                }
            };
            xml.open("POST", url, true);
            xml.setRequestHeader("Content-Type", "application/json");
            xml.send(JSON.stringify(json));
        }
    </script>
</body>
</html>
